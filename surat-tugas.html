<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Generator Surat Tugas | UPTD Kiarapedes</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap');
        
        body { 
            font-family: 'Inter', sans-serif; 
            background: #f1f5f9;
            background-image: radial-gradient(#cbd5e1 1px, transparent 1px);
            background-size: 20px 20px;
        }

        /* Dashboard Glassmorphism */
        .glass-panel {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.7);
        }

        /* Preview A4 Styling */
        .preview-container {
            perspective: 1000px;
        }
        
        .halaman-a4 {
            background: white;
            width: 210mm;
            min-height: 297mm;
            padding: 2cm;
            margin: 0 auto;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.15);
            box-sizing: border-box;
            color: black;
            transform-origin: top center;
        }

        .font-surat { font-family: "Times New Roman", Times, serif; }

        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #f1f5f9; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 10px; }
        ::-webkit-scrollbar-thumb:hover { background: #94a3b8; }

        /* Input Animations */
        .input-focus-effect {
            @apply border-slate-200 transition-all duration-300 focus:border-emerald-500 focus:ring-4 focus:ring-emerald-500/10;
        }
    </style>
</head>
<body class="antialiased">

<div class="no-print min-h-screen flex flex-col">
    <header class="bg-slate-900 text-white p-4 shadow-lg flex justify-between items-center px-8">
        <div class="flex items-center gap-3">
            <div class="bg-emerald-500 p-2 rounded-lg">
                <i class="fas fa-file-signature text-xl"></i>
            </div>
            <div>
                <h1 class="font-extrabold tracking-tight text-lg uppercase">Generator Surat Tugas</h1>
                <p class="text-[10px] text-slate-400 font-medium">PUSKESMAS KIARAPEDES</p>
            </div>
        </div>
        <div class="flex gap-3">
            <button onclick="simpanDraft()" class="px-4 py-2 bg-emerald-800 hover:bg-emerald-700 rounded-lg text-xs font-bold transition-all border border-slate-700">
                <i class="fas fa-save mr-2 text-emerald-400"></i> SIMPAN DRAFT
            </button>
            <button onclick="unduhPDF()" class="px-4 py-2 bg-orange-600 hover:bg-orange-500 rounded-lg text-xs font-bold transition-all shadow-lg shadow-emerald-900/20">
                <i class="fas fa-file-pdf mr-2"></i> EXPORT PDF
            </button>
        </div>
    </header>

    <div class="flex flex-1 overflow-hidden">
        <aside class="w-96 bg-white border-r border-slate-200 overflow-y-auto p-6 space-y-6">
            <div>
                <h3 class="text-xs font-black text-slate-400 uppercase tracking-[0.2em] mb-4 flex items-center">
                    <span class="w-8 h-[1px] bg-slate-200 mr-2"></span> Identitas Surat
                </h3>
                <div class="space-y-4">
                    <div class="grid grid-cols-2 gap-3">
                        <div class="space-y-1">
                            <label class="text-[11px] font-bold text-slate-600 ml-1">No. Urut</label>
                            <input type="number" id="noUrut" class="w-full p-2.5 bg-slate-50 border rounded-lg text-sm input-focus-effect font-semibold" placeholder="001" oninput="updateAll()">
                        </div>
                        <div class="space-y-1">
                            <label class="text-[11px] font-bold text-slate-600 ml-1">Tgl Dibuat</label>
                            <input type="date" id="tglDibuat" class="w-full p-2.5 bg-slate-50 border rounded-lg text-sm input-focus-effect font-semibold" onchange="updateAll()">
                        </div>
                    </div>
                </div>
            </div>

            <div>
                <h3 class="text-xs font-black text-slate-400 uppercase tracking-[0.2em] mb-4 flex items-center">
                    <span class="w-8 h-[1px] bg-slate-200 mr-2"></span> Detail Penugasan
                </h3>
                <div class="space-y-3">
                    <div class="grid grid-cols-2 gap-3">
                        <select id="hariTugas" class="p-2.5 bg-slate-50 border rounded-lg text-sm input-focus-effect font-semibold" onchange="updateAll()">
                            <option value="">Pilih Hari</option>
                            <option>Senin</option><option>Selasa</option><option>Rabu</option>
                            <option>Kamis</option><option>Jumat</option><option>Sabtu</option><option>Minggu</option>
                        </select>
                        <input type="date" id="tglTugas" class="p-2.5 bg-slate-50 border rounded-lg text-sm input-focus-effect font-semibold" onchange="updateAll()">
                    </div>
                    <input type="text" id="waktuTugas" class="w-full p-2.5 bg-slate-50 border rounded-lg text-sm input-focus-effect" placeholder="Waktu (contoh: 08.00 s/d Selesai)" oninput="updateAll()">
                    <input type="text" id="tempatTugas" class="w-full p-2.5 bg-slate-50 border rounded-lg text-sm input-focus-effect" placeholder="Lokasi Tujuan" oninput="updateAll()">
                    <textarea id="maksudTugas" class="w-full p-2.5 bg-slate-50 border rounded-lg text-sm input-focus-effect h-20" placeholder="Maksud Perjalanan Dinas..." oninput="updateAll()"></textarea>
                </div>
            </div>

            <div class="bg-emerald-50 rounded-2xl p-4 border border-emerald-100">
                <h3 class="text-[11px] font-black text-emerald-700 uppercase mb-3 flex items-center gap-2">
                    <i class="fas fa-users"></i> Personel Pelaksana
                </h3>
                <input type="text" id="cariPegawai" list="pegawaiList" class="w-full p-2.5 bg-white border border-emerald-200 rounded-xl text-sm outline-none focus:ring-2 focus:ring-emerald-500/20" placeholder="Ketik nama pegawai..." oninput="addPegawai()">
                <datalist id="pegawaiList"></datalist>
                <div id="badgePegawai" class="mt-4 flex flex-wrap gap-2"></div>
            </div>

            <div class="pt-4">
                <button onclick="location.reload()" class="w-full py-3 text-rose-500 font-bold text-xs hover:bg-rose-50 rounded-xl transition-all border border-transparent hover:border-rose-100">
                    <i class="fas fa-trash-alt mr-2"></i> RESET SEMUA DATA
                </button>
            </div>
        </aside>

        <main class="flex-1 overflow-y-auto p-12 bg-slate-100">
            <div class="preview-container flex flex-col items-center">
                <div class="mb-6 glass-panel px-6 py-3 rounded-full flex gap-6 items-center shadow-sm text-slate-600">
                    <div class="flex items-center gap-2">
                        <label class="text-[10px] font-black uppercase">Ukuran Logo</label>
                        <input type="range" id="sizeKab" min="40" max="100" value="70" class="w-20 accent-emerald-600" oninput="kalibrasi()">
                    </div>
                    <div class="w-[1px] h-4 bg-slate-300"></div>
                    </div>

                <div id="document-render" class="halaman-a4 font-surat">
                    <table class="w-full border-b-[4px] border-double border-black mb-6">
                        <tr>
                            <td class="pb-2" style="width: 15%;">
                                <img id="imgKab" src="https://blk.purwakartakab.go.id/wp-content/uploads/2021/10/LOGO-KABUPATEN-PURWAKARTA-229x300.png" style="width: 70px; margin-bottom: 5px;">
                            </td>
                            <td class="text-center pb-2">
                                <h2 class="text-[15pt] font-bold leading-tight uppercase">Pemerintah Kabupaten Purwakarta</h2>
                                <h2 class="text-[16pt] font-bold leading-tight uppercase">Dinas Kesehatan</h2>
                                <h2 class="text-[18pt] font-[900] leading-tight uppercase">UPTD Puskesmas Kiarapedes</h2>
                                <p class="text-[11pt] italic mt-1">Jl. Raya Kiarapedes No. 2 KM. 28 Kec. Kiarapedes</p>
                                <p class="text-[11pt] font">Kode Pos: 41175 Email: pkmkiarapedes20@gmail.com</p>
                            </td>
                            <td class="text-right pb-2" style="width: 15%;">
                                <img id="imgPkm" src="https://www.freepnglogos.com/uploads/logo-puskesmas-png/logo-puskesmas-lambang-baru-puskesmas-puskesmas-makale-3.png" style="width: 75px;">
                            </td>
                        </tr>
                    </table>

                    <div class="text-center mb-8">
                        <h3 class="text-[14pt] font-bold underline uppercase">Surat Tugas</h3>
                        <p class="font-bold tracking-wide" id="txtNomor">Nomor: 800/000/ST/PKM-KPDS/II/2026</p>
                    </div>

                    <div class="text-[11pt] leading-relaxed text-justify space-y-4">
                        <p>Yang bertanda tangan di bawah ini :</p>
                        <div class="ml-10">
                            <table class="w-full">
                                <tr><td class="w-24">Nama</td><td>: <span class="font-bold">H. Ujang Sutrisna, S.Kep., Ners., M.Kep</span></td></tr>
                                <tr><td>NIP</td><td>: 197707132006041011</td></tr>
                                <tr><td>Jabatan</td><td>: Kepala UPTD Puskesmas Kiarapedes</td></tr>
                            </table>
                        </div>

                        <p class="text-center font-bold tracking-[4px] my-6">MENUGASKAN</p>
                        
                        <p>Kepada :</p>
                        <table class="w-full border-collapse">
                            <thead>
                                <tr class="bg-slate-50">
                                    <th class="border border-black p-2 w-10 text-center">No</th>
                                    <th class="border border-black p-2 text-left">Nama / NIP</th>
                                    <th class="border border-black p-2 text-left">Jabatan</th>
                                </tr>
                            </thead>
                            <tbody id="tabelPegawai">
                                <tr><td colspan="3" class="border border-black p-4 text-center text-slate-400 italic font-sans">Belum ada pegawai yang dipilih</td></tr>
                            </tbody>
                        </table>

                        <p class="mt-4">Untuk melaksanakan <span id="txtMaksud" class="font-bold">..................</span> yang akan dilaksanakan pada :</p>
                        
                        <div class="ml-10">
                            <table class="w-full">
                                <tr><td class="w-24">Hari</td><td>: <span id="txtHari">..................</span></td></tr>
                                <tr><td>Tanggal</td><td>: <span id="txtTglTugas">..................</span></td></tr>
                                <tr><td>Waktu</td><td>: <span id="txtWaktu">..................</span></td></tr>
                                <tr><td>Tempat</td><td>: <span id="txtTempat">..................</span></td></tr>
                            </table>
                        </div>

                        <p class="mt-6">Demikian surat tugas ini dibuat untuk dapat dilaksanakan sebagaimana mestinya dengan penuh tanggung jawab.</p>
                    </div>

                    <div class="mt-12 ml-auto w-72 text-center">
                        <p>Kiarapedes, <span id="txtTglDibuat">13 Februari 2026</span></p>
                        <p class="font-bold leading-tight mt-1">Kepala<br>UPTD Puskesmas Kiarapedes</p>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>
</div>

<script>
    const DB_PEGAWAI = [
        { nama: "Ajat Hermawan", nip: "198102202025211054", jabatan: "Operator Layanan Operasional" },
        { nama: "Anas Muhiban, S.E.", nip: "199703242025211057", jabatan: "Penata Layanan Operasional" },
        { nama: "apt. Herni Ekaraharjo, S. Farm", nip: "198509272023212004", jabatan: "Ahli Pertama - Apoteker" },
        { nama: "apt. Tria Wulandari P, S. Farm", nip: "199210082022032009", jabatan: "Apoteker Ahli Muda" },
        { nama: "Ardiansyah Astriadi, A. Md. AK", nip: "198907272022031007", jabatan: "Pranata Laboratorium Kesehatan Terampil" },
        { nama: "Ari Niken Palupi, Amd.Keb.", nip: "198501202017042001", jabatan: "Bidan Mahir" },
        { nama: "Barir Ismaya Shofa, A. Md.", nip: "199307252019032006", jabatan: "Perawat Gigi Pelaksana/Terampil" },
        { nama: "Ceceng Firmansyah", nip: "198405232025211107", jabatan: "Pengelola Umum Operasional" },
        { nama: "Cici Wijayanti, Amd.Keb", nip: "198608022024212010", jabatan: "Bidan Terampil" },
        { nama: "Cindyaningrum, Amd. Keb", nip: "199401272025212073", jabatan: "Bidan Terampil" },
        { nama: "Cucu Cuhayati, S.Tr. Keb.", nip: "199408202024212013", jabatan: "Bidan Terampil" },
        { nama: "Cucu Suminar, Amd.Kep", nip: "196804171989032007", jabatan: "Perawat Penyelia" },
        { nama: "Dewi Novianti, Amk", nip: "198311112023212003", jabatan: "Terampil - Perawat" },
        { nama: "Dewi Yuliani, AMK", nip: "199103132024212002", jabatan: "Perawat Terampil" },
        { nama: "Dika Megianty Agustin, S.M.", nip: "199708222025212061", jabatan: "Penata Layanan Operasional" },
        { nama: "Dodo Widodo", nip: "198410122025211067", jabatan: "Operator Layanan Operasional" },
        { nama: "dr. Anna Mardyana", nip: "198606172023212005", jabatan: "Ahli Pertama - Dokter" },
        { nama: "dr. Hendric Hariansyah, M.K.M", nip: "199603282022031009", jabatan: "Dokter Ahli Muda" },
        { nama: "dr. Rizki Prasetyo", nip: "123456789101112134", jabatan: "Dokter Umum" },
        { nama: "dr. Zakariya", nip: "197509222006041007", jabatan: "Dokter Ahli Madya" },
        { nama: "drg. Fitri Nurzanah", nip: "199902032025062009", jabatan: "Dokter Gigi Ahli Pertama" },
        { nama: "Eka Prisna Nengsih, Amd. Kep", nip: "199605152025212081", jabatan: "Perawat Terampil" },
        { nama: "Garry Rachman, Amd.Kep", nip: "198509132025211002", jabatan: "Perawat Terampil" },
        { nama: "H. Ujang Sutrisna, S. Kep., Ners., M. Kep.", nip: "197707132006041011", jabatan: "Kepala Puskesmas" },
        { nama: "Harbangkit Rizki, Amd. Kes", nip: "199605202022031014", jabatan: "Perekam Medis Terampil" },
        { nama: "Haris Ridwansyah, S. Kep. Ners.", nip: "198105202008011004", jabatan: "Perawat Penyelia" },
        { nama: "Imas Teti Sugiharti, Amd.Keb", nip: "198702172017042001", jabatan: "Bidan Mahir" },
        { nama: "Irma Septiani, Amd. Keb.", nip: "199309082025212079", jabatan: "Bidan Terampil" },
        { nama: "Juwita Pebrara, Amd. Keb.", nip: "199002092024212007", jabatan: "Bidan Terampil" },
        { nama: "Kartikasari, Amd. Keb", nip: "199504232025212088", jabatan: "Bidan Terampil" },
        { nama: "Komariah, Amd.Keb.", nip: "198208202023212002", jabatan: "Terampil - Bidan" },
        { nama: "Lusi Fitriyani Caturmawati, A. Md. Farm", nip: "199104132022032013", jabatan: "Asisten Apoteker Terampil" },
        { nama: "Marina, Amd. Keb", nip: "199303052025212078", jabatan: "Bidan Terampil" },
        { nama: "Merri Diana, S.Tr. Keb.", nip: "197205122006042012", jabatan: "Bidan Penyelia" },
        { nama: "Mimah Nurhalimah, Amd.Keb", nip: "199106152025212098", jabatan: "Bidan Terampil" },
        { nama: "Muhamad Haris Romdoni, AMK.", nip: "199502052024211005", jabatan: "Perawat Terampil" },
        { nama: "Neni Supriyani, Amk", nip: "198204192008012006", jabatan: "Perawat Penyelia" },
        { nama: "Nining", nip: "198204072025212053", jabatan: "Operator Layanan Operasional" },
        { nama: "Popy Hasanah, Amd. AK", nip: "199812292024212009", jabatan: "Pranata Laboratorium Kesehatan Terampil" },
        { nama: "Rahayu Ratnasari, Amg", nip: "199103232019032003", jabatan: "Nutrisionis Mahir" },
        { nama: "Ratna Dewi, Amd.Keb", nip: "199101142024212015", jabatan: "Bidan Terampil" },
        { nama: "Rizki Rangga Triyana, A.Md. Kep.", nip: "198903012019031002", jabatan: "Perawat Mahir" },
        { nama: "Rohman", nip: "198610292025211068", jabatan: "Operator Layanan Operasional" },
        { nama: "Rudi Subarkat, S. Kep", nip: "199109232023211003", jabatan: "Terampil - Perawat" },
        { nama: "Samirah, Amd. Keb.", nip: "198905312024212002", jabatan: "Tenaga Promosi Kesehatan" },
        { nama: "Siska Apriliani, Amd. Keb.", nip: "199804132024212005", jabatan: "Bidan Terampil" },
        { nama: "Siswinarti, S.Kep. Ners.", nip: "198204272009022005", jabatan: "Perawat Ahli Pertama" },
        { nama: "Siti Fatimah, Amk", nip: "199108042024212012", jabatan: "Perawat Terampil" },
        { nama: "Siti Rohmah, AMK", nip: "198306252008012002", jabatan: "Perawat Penyelia" },
        { nama: "Sri Endang Sukmayati", nip: "200206012025212009", jabatan: "Operator Layanan Operasional" },
        { nama: "Sri Sumarti, SKM", nip: "197503232006042021", jabatan: "Bidan Mahir" },
        { nama: "Susilawati, Amd.Keb.", nip: "198404062019032004", jabatan: "Bidan Mahir" },
        { nama: "Tanti Kemalasari, Amd.Farm.", nip: "199511192024212009", jabatan: "Asisten Apoteker Terampil" },
        { nama: "Tating Kusmiati, Amd. Keb.", nip: "199310112024212011", jabatan: "Bidan Terampil" },
        { nama: "Tika Ayu Lestari, Amd. Keb.", nip: "199402012025212076", jabatan: "Bidan Terampil" },
        { nama: "Tita Rosmiati, Amd.Keb", nip: "197608182006042023", jabatan: "Bidan Mahir" },
        { nama: "Titin Sutinah, Amd. Keb", nip: "197701212006042012", jabatan: "Bidan Mahir" },
        { nama: "Tika Azlia Rachmawati, Amd.Kes", nip: "200209092025062007", jabatan: "Tenaga Sanitasi Lingkungan" },
        { nama: "Ujang Kartono", nip: "198103222009011001", jabatan: "Pengadministrasi Umum" },
        { nama: "Vivit Nopiyanti, Amd.Keb.", nip: "198411042017042001", jabatan: "Bidan Mahir" },
        { nama: "Widya Kusumawati, S.E.", nip: "199708152025212066", jabatan: "Penata Layanan Operasional" },
        { nama: "Yeni Heryani", nip: "198510212025212047", jabatan: "Operator Layanan Operasional" }
    ];

    let terpilih = [];

    // Init datalist
    const dl = document.getElementById('pegawaiList');
    DB_PEGAWAI.forEach(p => { let o = document.createElement('option'); o.value = p.nama; dl.appendChild(o); });

    function addPegawai() {
        const inp = document.getElementById('cariPegawai');
        const p = DB_PEGAWAI.find(x => x.nama === inp.value);
        if(p && !terpilih.find(t => t.nip === p.nip)) {
            terpilih.push(p);
            inp.value = "";
            renderPegawai();
        }
    }

    function renderPegawai() {
        document.getElementById('badgePegawai').innerHTML = terpilih.map((p, i) => `
            <div class="group bg-emerald-50 text-emerald-700 px-3 py-1.5 rounded-lg text-[11px] font-bold border border-emerald-100 flex items-center gap-2 hover:bg-emerald-100 transition-all">
                ${p.nama} 
                <button onclick="terpilih.splice(${i},1);renderPegawai();" class="text-emerald-400 hover:text-rose-500"><i class="fas fa-times"></i></button>
            </div>
        `).join('');

        const tbody = document.getElementById('tabelPegawai');
        tbody.innerHTML = terpilih.length ? terpilih.map((p, i) => `
            <tr>
                <td class="border border-black text-center p-2">${i+1}</td>
                <td class="border border-black p-2 font-bold">${p.nama}<br><span class="font-normal text-[10pt]">NIP. ${p.nip}</span></td>
                <td class="border border-black p-2">${p.jabatan}</td>
            </tr>
        `).join('') : '<tr><td colspan="3" class="border border-black p-4 text-center text-slate-400 italic font-sans">Belum ada pegawai dipilih</td></tr>';
    }

    function updateAll() {
        const no = document.getElementById('noUrut').value || "0";
        const tglDStr = document.getElementById('tglDibuat').value;
        const dt = tglDStr ? new Date(tglDStr + "T00:00:00") : new Date();
        const bln = ["I","II","III","IV","V","VI","VII","VIII","IX","X","XI","XII"][dt.getMonth()];

        document.getElementById('txtNomor').innerText = `Nomor: 800/${no.toString().padStart(3,'0')}/ST/PKM-KPDS/${bln}/${dt.getFullYear()}`;
        document.getElementById('txtTglDibuat').innerText = dt.toLocaleDateString('id-ID', {day:'numeric', month:'long', year:'numeric'});
        
        document.getElementById('txtHari').innerText = document.getElementById('hariTugas').value || "..................";
        document.getElementById('txtMaksud').innerText = document.getElementById('maksudTugas').value || "..................";
        document.getElementById('txtTempat').innerText = document.getElementById('tempatTugas').value || "..................";
        document.getElementById('txtWaktu').innerText = document.getElementById('waktuTugas').value || "..................";
        
        const tglTStr = document.getElementById('tglTugas').value;
        document.getElementById('txtTglTugas').innerText = tglTStr ? new Date(tglTStr + "T00:00:00").toLocaleDateString('id-ID', {day:'numeric', month:'long', year:'numeric'}) : "..................";
    }

    function kalibrasi() {
        const size = document.getElementById('sizeKab').value;
        document.getElementById('imgKab').style.width = size + "px";
        document.getElementById('imgPkm').style.width = (parseInt(size) + 5) + "px";
    }

    function unduhPDF() {
        const element = document.getElementById('document-render');
        const nomor = document.getElementById('noUrut').value || "000";
        html2pdf().from(element).set({
            margin: 0,
            filename: `ST_PKM_KPDS_${nomor}.pdf`,
            html2canvas: { scale: 3 },
            jsPDF: { unit: 'mm', format: 'a4', orientation: 'portrait' }
        }).save();
    }

    function simpanDraft() {
        const data = {
            noUrut: document.getElementById('noUrut').value,
            tglDibuat: document.getElementById('tglDibuat').value,
            hariTugas: document.getElementById('hariTugas').value,
            tglTugas: document.getElementById('tglTugas').value,
            waktuTugas: document.getElementById('waktuTugas').value,
            tempatTugas: document.getElementById('tempatTugas').value,
            maksudTugas: document.getElementById('maksudTugas').value,
            pegawai: terpilih
        };
        localStorage.setItem('draftSurat', JSON.stringify(data));
        alert("Draft berhasil disimpan!");
    }

    window.onload = () => {
        const draft = JSON.parse(localStorage.getItem('draftSurat'));
        if(draft) {
            Object.keys(draft).forEach(key => {
                if(key !== 'pegawai') {
                    const el = document.getElementById(key);
                    if(el) el.value = draft[key];
                }
            });
            terpilih = draft.pegawai || [];
            renderPegawai();
            updateAll();
        }
    };
</script>
</body>
</html>
